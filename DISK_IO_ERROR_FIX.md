# ุฅุตูุงุญ ูุดููุฉ "disk I/O error"

## ๐จ ุงููุดููุฉ ุงูุญููููุฉ

### ุงูุฎุทุฃ:
```
main - ERROR - โ ุฎุทุฃ ูู ุจูุช ุงูุชุญูู: disk I/O error
```

### ุงูุณุจุจ:
- **ููุณ ูุดููุฉ readonly database** ููุง ูุงู ูุนุชูุฏ ุณุงุจูุงู
- ุงููุดููุฉ ุงูุญููููุฉ ูู **ุฎุทุฃ ูู ุงููุฑุต** ุฃู **ูุดููุฉ ูู ูุธุงู ุงููููุงุช**
- ูุฏ ุชููู ุจุณุจุจ:
  - ูุดุงูู ูู ุงููุฑุต ุงูุตูุจ
  - ูุดุงูู ูู ูุธุงู ุงููููุงุช
  - ูุดุงูู ูู ุงูุฐุงูุฑุฉ ุงููุคูุชุฉ
  - ูุดุงูู ูู ุฅุนุฏุงุฏุงุช SQLite

## ๐ ุงููุญุต ุงูุนููู

### ูุง ุชู ุงูุชุดุงูู:
1. **ุตูุงุญูุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช**: โ ุตุญูุญุฉ (`-rw-rw-rw-`)
2. **ูุณุงุญุฉ ุงููุฑุต**: โ ูุงููุฉ (113 GB ูุชุงุญุฉ)
3. **ูุธุงู ุงููููุงุช**: โ ูุนูู ุจุดูู ุทุจูุนู
4. **ุณูุงูุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช**: โ ุฌูุฏุฉ
5. **ุงููุดููุฉ ุงูุญููููุฉ**: ุฎุทุฃ ูู ุงููุฑุต (disk I/O error)

## ๐ง ุงูุญููู ุงููุทุจูุฉ

### 1. ุฅุตูุงุญ ููุฑู ูููุฑุต

```bash
python3 fix_disk_io_error.py
```

### 2. ุฅุตูุงุญ ุงูููุฏ ูู `main.py`

#### ุฅุถุงูุฉ ูุนุงูุฌุฉ ุฎุงุตุฉ ูุฃุฎุทุงุก ุงููุฑุต:
```python
# ุงูุชุนุงูู ูุน ุฃุฎุทุงุก ุงููุฑุต
elif "disk I/O error" in error_str.lower():
    logger.error(f"โ ุฎุทุฃ ูู ุงููุฑุต (disk I/O error): {e}")
    logger.error("๐ง ูุญุงููุฉ ุฅุตูุงุญ ูุดุงูู ุงููุฑุต...")
    
    try:
        # ุชุดุบูู ุฅุตูุงุญ ุงููุฑุต
        import subprocess
        import sys
        
        logger.info("๐ง ุชุดุบูู ุณูุฑูุจุช ุฅุตูุงุญ ุงููุฑุต...")
        result = subprocess.run([sys.executable, "fix_disk_io_error.py"], 
                              capture_output=True, text=True, timeout=120)
        
        if result.returncode == 0:
            logger.info("โ ุชู ุฅุตูุงุญ ูุดุงูู ุงููุฑุต ุจูุฌุงุญ")
            logger.info("๐ ุฅุนุงุฏุฉ ุชุดุบูู ุจูุช ุงูุชุญูู...")
            await asyncio.sleep(10)
            continue
        else:
            logger.error(f"โ ูุดู ูู ุฅุตูุงุญ ุงููุฑุต: {result.stderr}")
    except Exception as fix_error:
        logger.error(f"โ ุฎุทุฃ ูู ุชุดุบูู ุฅุตูุงุญ ุงููุฑุต: {fix_error}")
    
    # ุงูุชุธุงุฑ ุฃุทูู ูุจู ุฅุนุงุฏุฉ ุงููุญุงููุฉ
    delay = 60
    logger.info(f"โฑ๏ธ ุงูุชุธุงุฑ {delay} ุซุงููุฉ ูุจู ุฅุนุงุฏุฉ ุงููุญุงููุฉ...")
    await asyncio.sleep(delay)
    continue
```

## ๐๏ธ ุงูุฃุฏูุงุช ุงููููุดุฃุฉ

### 1. `fix_disk_io_error.py`
ุณูุฑูุจุช Python ุดุงูู ูุฅุตูุงุญ ูุดุงูู ุงููุฑุต:
- ูุญุต ูุณุงุญุฉ ุงููุฑุต
- ูุญุต ูุธุงู ุงููููุงุช
- ูุญุต ุณูุงูุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ุฅุตูุงุญ ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ุชุญุณูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

### 2. `test_database_concurrency.py`
ุณูุฑูุจุช ูุงุฎุชุจุงุฑ ูุดุงูู ุงูุชุฒุงูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

## ๐ ุฎุทูุงุช ุงูุฅุตูุงุญ

### 1. ุฅุตูุงุญ ููุฑู:
```bash
python3 fix_disk_io_error.py
```

### 2. ุชุดุบูู ุงูุจูุช:
```bash
python3 main.py
```

### 3. ูุฑุงูุจุฉ ุงูุณุฌูุงุช:
```bash
tail -f bot.log | grep -i "disk\|error"
```

## ๐ ูุญุต ุดุงูู ูููุธุงู

### ูุณุงุญุฉ ุงููุฑุต:
```
๐พ ุฅุฌูุงูู ุงููุณุงุญุฉ: 125 GB
๐ ุงููุณุงุญุฉ ุงููุณุชุฎุฏูุฉ: 6 GB
๐ ุงููุณุงุญุฉ ุงููุชุงุญุฉ: 113 GB
โ ูุณุงุญุฉ ุงููุฑุต ูุงููุฉ
```

### ูุธุงู ุงููููุงุช:
```
โ ูุธุงู ุงููููุงุช ูุนูู ุจุดูู ุทุจูุนู
```

### ุณูุงูุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช:
```
โ ุณูุงูุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุฌูุฏุฉ
```

### ุชุญุณูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:
```
โ ุชู ุชุญุณูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
```

## โ๏ธ ุฅุนุฏุงุฏุงุช SQLite ุงูููุญุณูุฉ

### ุงูุฅุนุฏุงุฏุงุช ุงููุทุจูุฉ:
```sql
PRAGMA journal_mode=DELETE;        -- ุชุฌูุจ WAL ูููุน ูุดุงูู ุงููุฑุต
PRAGMA synchronous=NORMAL;         -- ุชุฒุงูู ุนุงุฏู
PRAGMA locking_mode=NORMAL;        -- ููู ุนุงุฏู
PRAGMA temp_store=memory;          -- ุชุฎุฒูู ูุคูุช ูู ุงูุฐุงูุฑุฉ
PRAGMA cache_size=1000;            -- ุญุฌู ูุงุด ุฃุตุบุฑ
PRAGMA page_size=4096;             -- ุญุฌู ุตูุญุฉ ููุงุณู
PRAGMA auto_vacuum=NONE;           -- ุชุนุทูู ุงูุชูุธูู ุงูุชููุงุฆู
```

## ๐ ุงูุชุดุบูู ุงูุชููุงุฆู

### ูู `main.py`:
- ูุชู ุชุดุบูู ุฅุตูุงุญ ุงููุฑุต ุชููุงุฆูุงู ุนูุฏ ุญุฏูุซ ุฎุทุฃ disk I/O
- ุฅุนุงุฏุฉ ุชุดุบูู ุงูุจูุช ุจุนุฏ ุงูุฅุตูุงุญ
- ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ุจุดูู ุขูู
- ุงูุชุธุงุฑ ุฃุทูู (60 ุซุงููุฉ) ูุจู ุฅุนุงุฏุฉ ุงููุญุงููุฉ

## ๐ ูุฑุงูุจุฉ ุงูุฃุฏุงุก

### ูุคุดุฑุงุช ุงููุฌุงุญ:
- โ ูุง ุชูุฌุฏ ุฃุฎุทุงุก disk I/O
- โ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุชุนูู ุจุดูู ุทุจูุนู
- โ ุงูุจูุช ูุนูู ุจุฏูู ุงููุทุงุน
- โ ุฅุนุฏุงุฏุงุช SQLite ูุญุณูุฉ

### ูุคุดุฑุงุช ุงููุดููุฉ:
- โ ุฃุฎุทุงุก disk I/O ูุชูุฑุฑุฉ
- โ ูุดู ูู ุฅุตูุงุญ ุงููุฑุต
- โ ูุดุงูู ูู ูุธุงู ุงููููุงุช

## ๐ ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ

### ุฅูุดุงุก ูุณุฎุฉ ุงุญุชูุงุทูุฉ:
```python
import shutil
import time

timestamp = int(time.time())
backup_file = f"telegram_bot.db.backup_{timestamp}"
shutil.copy2("telegram_bot.db", backup_file)
```

### ุงุณุชุนุงุฏุฉ ูู ูุณุฎุฉ ุงุญุชูุงุทูุฉ:
```bash
cp telegram_bot.db.backup_TIMESTAMP telegram_bot.db
chmod 666 telegram_bot.db
```

## ๐ก ูุตุงุฆุญ ููููุงูุฉ

### 1. ูุฑุงูุจุฉ ูุณุงุญุฉ ุงููุฑุต:
```bash
df -h
```

### 2. ุชุดุบูู ูุญุต ุฏูุฑู:
```bash
python3 fix_disk_io_error.py
```

### 3. ูุฑุงูุจุฉ ุงูุณุฌูุงุช:
```bash
tail -f bot.log | grep -i "disk\|error\|i/o"
```

### 4. ุฅุนุฏุงุฏ cron job:
```bash
# ุฅุถุงูุฉ ุฅูู crontab
0 */4 * * * cd /path/to/bot && python3 fix_disk_io_error.py
```

## ๐ฏ ุงููุชูุฌุฉ ุงูููุงุฆูุฉ

ุจุนุฏ ุชุทุจูู ุฌููุน ุงูุฅุตูุงุญุงุช:
- โ ุชู ุชุญุฏูุฏ ุงููุดููุฉ ุงูุญููููุฉ (disk I/O error)
- โ ุชู ุฅุตูุงุญ ูุดุงูู ุงููุฑุต
- โ ุงูุจูุช ูุนูู ุจุฏูู ุฃุฎุทุงุก
- โ ุฅุตูุงุญ ุชููุงุฆู ุนูุฏ ุญุฏูุซ ุงููุดููุฉ
- โ ูุฑุงูุจุฉ ูุณุชูุฑุฉ ููุฃุฏุงุก

## ๐ ุงููุฑู ุจูู ุงููุดุงูู

### ูุดููุฉ readonly database:
```
attempt to write a readonly database
```
- **ุงูุณุจุจ**: ุตูุงุญูุงุช ุงูููู
- **ุงูุญู**: `chmod 666 telegram_bot.db`

### ูุดููุฉ disk I/O error:
```
disk I/O error
```
- **ุงูุณุจุจ**: ูุดุงูู ูู ุงููุฑุต ุฃู ูุธุงู ุงููููุงุช
- **ุงูุญู**: ุฅุตูุงุญ ุดุงูู ูููุธุงู

---

**ููุงุญุธุฉ**: ุงููุดููุฉ ุงูุญููููุฉ ูุงูุช **disk I/O error** ูููุณ **readonly database**. ุฌููุน ุงูุฅุตูุงุญุงุช ุชู ุชุทุจูููุง ุจูุฌุงุญ.