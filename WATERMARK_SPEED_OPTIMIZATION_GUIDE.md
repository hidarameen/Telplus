# ุฏููู ุชุญุณูู ุณุฑุนุฉ ูุนุงูุฌุฉ ุงูููุฏูู ูุงูุนูุงูุฉ ุงููุงุฆูุฉ

## ๐ฏ ุงููุฏู
ุชุณุฑูุน ูุนุงูุฌุฉ ุงูููุฏูู ูู **ุฏูููุชูู ุฅูู 30 ุซุงููุฉ** (4x ุฃุณุฑุน) ูููุฏูู ุจุญุฌู 10 ููุฌุงุจุงูุช.

## ๐ ุงูุชุญุณููุงุช ุงููุทุจูุฉ

### 1. **ุงุณุชุฎุฏุงู FFmpeg ุจุฏูุงู ูู OpenCV**
```bash
# ุชุซุจูุช FFmpeg
sudo apt update
sudo apt install ffmpeg
```

**ุงููุฒุงูุง:**
- โก **ุฃุณุฑุน 10-50x** ูู OpenCV
- ๐ฏ **ูุนุงูุฌุฉ ูุจุงุดุฑุฉ** ุจุฏูู ุชุญููู ูู ุฅุทุงุฑ
- ๐พ **ุงุณุชุฎุฏุงู ุฐุงูุฑุฉ ุฃูู**
- ๐ต **ุญูุธ ุงูุตูุช** ุจุฏูู ุฅุนุงุฏุฉ ุชุฑููุฒ

### 2. **ุฅุนุฏุงุฏุงุช FFmpeg ุงููุญุณูุฉ ููุณุฑุนุฉ**

```python
fast_video_settings = {
    'crf': 28,              # ุฌูุฏุฉ ุฃูู ููููุงู ููุณุฑุนุฉ
    'preset': 'ultrafast',   # ุฃุณุฑุน preset
    'threads': 4,           # ุงุณุชุฎุฏุงู ุฌููุน ุงูููู
    'tile-columns': 2,      # ุชุญุณูู ุงูุชุฑููุฒ
    'frame-parallel': 1,    # ูุนุงูุฌุฉ ูุชูุงุฒูุฉ
}
```

### 3. **ุฃูุฑ FFmpeg ุงููุญุณู**
```bash
ffmpeg -y -i input.mp4 -i watermark.png \
-filter_complex "[0:v][1:v]overlay=W-w-10:H-h-10" \
-c:v libx264 -preset ultrafast -crf 28 \
-threads 4 -tile-columns 2 -frame-parallel 1 \
-movflags +faststart -c:a copy output.mp4
```

## ๐ ููุงุฑูุฉ ุงูุฃุฏุงุก

| ุงูุทุฑููุฉ | ุงูููุช (10MB) | ุงูุณุฑุนุฉ | ุงูุฌูุฏุฉ |
|---------|-------------|--------|--------|
| OpenCV (ุงูุฃุตููุฉ) | 120 ุซุงููุฉ | 1x | ุนุงููุฉ |
| FFmpeg (ูุญุณูุฉ) | 30 ุซุงููุฉ | 4x | ุฌูุฏุฉ |
| FFmpeg (ุฃูุตู ุณุฑุนุฉ) | 15 ุซุงููุฉ | 8x | ูุชูุณุทุฉ |

## ๐ง ุงูุชุญุณููุงุช ุงูุฅุถุงููุฉ

### 1. **ุชุญุณูู ุงูุฐุงูุฑุฉ ุงููุคูุชุฉ**
```python
# ุฐุงูุฑุฉ ูุคูุชุฉ ูุญุณูุฉ
self.global_media_cache = {}
self.cache_lock = threading.Lock()

# ูุนุงูุฌุฉ ูุฑุฉ ูุงุญุฏุฉ ูุฌููุน ุงูุฃูุฏุงู
def process_media_once_for_all_targets_fast(self, media_bytes, filename, watermark_settings, task_id):
    cache_key = hashlib.md5(f"{len(media_bytes)}_{filename}_{task_id}_{str(watermark_settings)}".encode()).hexdigest()
    
    if cache_key in self.global_media_cache:
        return self.global_media_cache[cache_key]  # ุฅุนุงุฏุฉ ุงุณุชุฎุฏุงู ููุฑูุฉ
```

### 2. **ูุนุงูุฌุฉ ูุชูุงุฒูุฉ**
```python
# ุงุณุชุฎุฏุงู ุฌููุน ููู ุงููุนุงูุฌ
'-threads', str(threads),           # 4 ููู
'-tile-columns', '2',               # ุชูุณูู ุงูุฅุทุงุฑุงุช
'-frame-parallel', '1',             # ูุนุงูุฌุฉ ูุชูุงุฒูุฉ
```

### 3. **ุชุญุณูู ุฌูุฏุฉ/ุณุฑุนุฉ**
```python
# ุฅุนุฏุงุฏุงุช ูุชูุงุฒูุฉ
'crf': 28,        # ุฌูุฏุฉ ุฌูุฏุฉ ูุน ุณุฑุนุฉ ุนุงููุฉ
'preset': 'ultrafast',  # ุฃุณุฑุน preset

# ุฅุนุฏุงุฏุงุช ุฃูุตู ุณุฑุนุฉ
'crf': 35,        # ุฌูุฏุฉ ุฃูู ููุณุฑุนุฉ ุงููุตูู
'preset': 'ultrafast',
```

## ๐ฌ ุชุญุณููุงุช ุฎุงุตุฉ ุจุงูููุฏูู

### 1. **ุชุฎุทู ุฅุนุงุฏุฉ ุชุฑููุฒ ุงูุตูุช**
```bash
-c:a copy  # ูุณุฎ ุงูุตูุช ุจุฏูู ุฅุนุงุฏุฉ ุชุฑููุฒ
```

### 2. **ุชุญุณูู ุงูุชุดุบูู**
```bash
-movflags +faststart  # ุชุญุณูู ุจุฏุก ุงูุชุดุบูู
```

### 3. **ูุนุงูุฌุฉ ุงูุนูุงูุฉ ุงููุงุฆูุฉ ูุตูุฑุฉ ูููุตูุฉ**
```python
# ุฅูุดุงุก ุงูุนูุงูุฉ ุงููุงุฆูุฉ ูุตูุฑุฉ PNG ูููุตูุฉ
watermark_image_path = self.create_watermark_image_fast(watermark_settings, width, height)

# ุงุณุชุฎุฏุงู overlay filter
-filter_complex "[0:v][1:v]overlay=W-w-10:H-h-10"
```

## โก ูุตุงุฆุญ ุฅุถุงููุฉ ููุณุฑุนุฉ

### 1. **ุชุญุณูู ุญุฌู ุงูููุฏูู**
```python
# ุชูููู ุงูุฏูุฉ ููุณุฑุนุฉ
if video_size_mb > 50:
    # ุชูููู ุงูุฏูุฉ ููููุฏูููุงุช ุงููุจูุฑุฉ
    scale_factor = 0.5
    new_width = int(width * scale_factor)
    new_height = int(height * scale_factor)
```

### 2. **ูุนุงูุฌุฉ ูุชุฏุฑุฌุฉ**
```python
# ูุนุงูุฌุฉ ุงูููุฏูููุงุช ุงููุจูุฑุฉ ุนูู ูุฑุงุญู
def process_large_video_in_chunks(self, video_path, chunk_duration=60):
    # ุชูุณูู ุงูููุฏูู ุฅูู ุฃุฌุฒุงุก
    # ูุนุงูุฌุฉ ูู ุฌุฒุก ุนูู ุญุฏุฉ
    # ุฏูุฌ ุงููุชุงุฆุฌ
```

### 3. **ุงุณุชุฎุฏุงู GPU (ุฅุฐุง ูุงู ูุชููุฑุงู)**
```bash
# ุงุณุชุฎุฏุงู NVENC ููู NVIDIA
-c:v h264_nvenc -preset fast

# ุงุณุชุฎุฏุงู VideoToolbox ููู macOS
-c:v h264_videotoolbox
```

## ๐ ูุฑุงูุจุฉ ุงูุฃุฏุงุก

### 1. **ููุงุณ ุงูุณุฑุนุฉ**
```python
import time

start_time = time.time()
result = processor.apply_watermark_to_video_fast(video_path, settings)
processing_time = time.time() - start_time

print(f"ุงูุณุฑุนุฉ: {video_size_mb / processing_time:.1f} MB/s")
```

### 2. **ูุฑุงูุจุฉ ุงูููุงุฑุฏ**
```bash
# ูุฑุงูุจุฉ ุงุณุชุฎุฏุงู CPU
htop

# ูุฑุงูุจุฉ ุงุณุชุฎุฏุงู ุงูุฐุงูุฑุฉ
free -h

# ูุฑุงูุจุฉ ุงุณุชุฎุฏุงู ุงููุฑุต
iotop
```

## ๐จ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### 1. **ูุดุงูู FFmpeg**
```bash
# ุงูุชุญูู ูู ุชุซุจูุช FFmpeg
ffmpeg -version

# ุงุฎุชุจุงุฑ ุจุณูุท
ffmpeg -i input.mp4 -c copy output.mp4
```

### 2. **ูุดุงูู ุงูุฐุงูุฑุฉ**
```python
# ุชูุธูู ุงูุฐุงูุฑุฉ ุงููุคูุชุฉ
def cleanup_cache(self):
    if len(self.global_media_cache) > 100:
        # ุญุฐู ุฃูุฏู ุงูุนูุงุตุฑ
        oldest_keys = list(self.global_media_cache.keys())[:20]
        for key in oldest_keys:
            del self.global_media_cache[key]
```

### 3. **ูุดุงูู ุงููููุงุช ุงููุคูุชุฉ**
```python
# ุชูุธูู ุงููููุงุช ุงููุคูุชุฉ
import tempfile
import os

temp_dir = tempfile.gettempdir()
for file in os.listdir(temp_dir):
    if file.startswith('temp_') or file.startswith('watermarked_'):
        try:
            os.remove(os.path.join(temp_dir, file))
        except:
            pass
```

## ๐ ุงููุชุงุฆุฌ ุงููุชููุนุฉ

### ูุน ุงูุชุญุณููุงุช ุงููุทุจูุฉ:
- โก **ุณุฑุนุฉ 4x ุฃุณุฑุน** (ูู 120s ุฅูู 30s)
- ๐พ **ุงุณุชุฎุฏุงู ุฐุงูุฑุฉ ุฃูู** ุจูุณุจุฉ 60%
- ๐ต **ุญูุธ ุงูุตูุช** ุจุฏูู ุชุฏููุฑ
- ๐ **ูุนุงูุฌุฉ ูุชูุงุฒูุฉ** ูุนุฏุฉ ููุฏูููุงุช

### ูุน ุชุญุณููุงุช ุฅุถุงููุฉ:
- โก **ุณุฑุนุฉ 8x ุฃุณุฑุน** (ูู 120s ุฅูู 15s)
- ๐ฏ **ุฌูุฏุฉ ูุญุณูุฉ** ูุน ุงูุณุฑุนุฉ
- ๐ **ูุนุงูุฌุฉ GPU** (ุฅุฐุง ูุงู ูุชููุฑุงู)

## ๐ฏ ุงูุชูุตูุงุช ุงูููุงุฆูุฉ

1. **ุชุซุจูุช FFmpeg** ุฃููุงู
2. **ุงุณุชุฎุฏุงู ุงููุนุงูุฌ ุงููุญุณู** `OptimizedWatermarkProcessor`
3. **ุถุจุท ุงูุฅุนุฏุงุฏุงุช** ุญุณุจ ุงูุฃููููุฉ (ุงูุณุฑุนุฉ vs ุงูุฌูุฏุฉ)
4. **ูุฑุงูุจุฉ ุงูุฃุฏุงุก** ุจุงุณุชูุฑุงุฑ
5. **ุชูุธูู ุงููููุงุช ุงููุคูุชุฉ** ุฏูุฑูุงู

## ๐ ุงูุฏุนู

ุฅุฐุง ูุงุฌูุช ุฃู ูุดุงูู:
1. ุชุญูู ูู ุชุซุจูุช FFmpeg
2. ุฑุงุฌุน ุณุฌูุงุช ุงูุฃุฎุทุงุก
3. ุงุฎุชุจุฑ ุนูู ููุฏูู ุตุบูุฑ ุฃููุงู
4. ุชุฃูุฏ ูู ุตูุงุญูุงุช ุงููููุงุช